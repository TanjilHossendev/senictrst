class CDCalculator{constructor(){this.chart=null,this.currentResults=null,this.isDarkMode="true"===localStorage.getItem("darkMode"),this.init()}init(){this.setupEventListeners(),this.setupDarkMode(),this.setupTooltips(),this.setupAccessibility(),this.setupFAQ(),this.calculateCD()}setupEventListeners(){const t=document.getElementById("cdForm");t.querySelectorAll("input, select").forEach(t=>{t.addEventListener("input",()=>this.calculateCD()),t.addEventListener("change",()=>this.calculateCD())}),t.addEventListener("submit",t=>{t.preventDefault(),this.calculateCD()}),t.addEventListener("reset",t=>{setTimeout(()=>{this.resetResults(),this.calculateCD()},100)}),document.querySelectorAll(".quick-term-btn").forEach(t=>{t.addEventListener("click",t=>{const e=t.target.dataset.term,n=t.target.dataset.unit;document.getElementById("term").value=e,document.getElementById("termUnit").value=n,this.calculateCD()})}),document.getElementById("exportPDF").addEventListener("click",()=>{this.exportToPDF()}),document.getElementById("shareResults").addEventListener("click",()=>{this.shareResults()});const e=document.getElementById("mobileMenuBtn"),n=document.getElementById("mobileMenu");e&&n&&e.addEventListener("click",()=>{n.classList.toggle("hidden")})}setupDarkMode(){const t=document.getElementById("darkModeToggle");this.isDarkMode&&document.documentElement.classList.add("dark"),t.addEventListener("click",()=>{this.isDarkMode=!this.isDarkMode,document.documentElement.classList.toggle("dark"),localStorage.setItem("darkMode",this.isDarkMode),this.chart&&this.updateChartTheme()})}setupTooltips(){const t=document.getElementById("tooltip");document.querySelectorAll(".tooltip-trigger").forEach(e=>{e.addEventListener("mouseenter",e=>{const n=e.target.dataset.tooltip;t.textContent=n,t.classList.remove("opacity-0"),t.classList.add("opacity-100"),this.positionTooltip(e.target,t)}),e.addEventListener("mouseleave",()=>{t.classList.remove("opacity-100"),t.classList.add("opacity-0")}),e.addEventListener("focus",e=>{const n=e.target.dataset.tooltip;t.textContent=n,t.classList.remove("opacity-0"),t.classList.add("opacity-100"),this.positionTooltip(e.target,t)}),e.addEventListener("blur",()=>{t.classList.remove("opacity-100"),t.classList.add("opacity-0")})})}positionTooltip(t,e){const n=t.getBoundingClientRect(),a=e.getBoundingClientRect();let o=n.left+n.width/2-a.width/2,s=n.top-a.height-10;o<10&&(o=10),o+a.width>window.innerWidth-10&&(o=window.innerWidth-a.width-10),s<10&&(s=n.bottom+10),e.style.left=`${o}px`,e.style.top=`${s}px`}setupAccessibility(){document.addEventListener("keydown",t=>{if("Escape"===t.key){const t=document.getElementById("mobileMenu");t&&!t.classList.contains("hidden")&&t.classList.add("hidden");const e=document.getElementById("tooltip");e.classList.remove("opacity-100"),e.classList.add("opacity-0")}});const t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.id="results-announcer",document.body.appendChild(t)}setupFAQ(){document.querySelectorAll(".faq-question").forEach(t=>{t.addEventListener("click",()=>{const e=t.closest(".faq-item").querySelector(".faq-answer"),n=t.querySelector("i");e.classList.toggle("hidden"),e.classList.contains("hidden")?n.style.transform="rotate(0deg)":n.style.transform="rotate(180deg)"})})}validateInputs(){const t=document.getElementById("cdForm"),e=parseFloat(t.principal.value)||0,n=parseInt(t.term.value)||0,a=parseFloat(t.rate.value)||0;let o=!0;const s=document.getElementById("principalError");e<1?(s.textContent="Principal must be at least $1",s.classList.remove("hidden"),o=!1):s.classList.add("hidden");const i=document.getElementById("termError");n<1?(i.textContent="Term must be at least 1",i.classList.remove("hidden"),o=!1):i.classList.add("hidden");const r=document.getElementById("rateError");return a<.01||a>50?(r.textContent="Rate must be between 0.01% and 50%",r.classList.remove("hidden"),o=!1):r.classList.add("hidden"),o}calculateCD(){if(!this.validateInputs())return;const t=document.getElementById("cdForm"),e=parseFloat(t.principal.value)||1e4,n=parseInt(t.term.value)||5,a=t.termUnit.value,o=parseFloat(t.rate.value)||3.5,s=t.compound.value,i=t.querySelector('input[name="interestType"]:checked').value,r="months"===a?n/12:n,l={daily:365,monthly:12,quarterly:4,annually:1}[s];let c;c="simple"===i?this.calculateSimpleInterest(e,o,r):this.calculateCompoundInterest(e,o,r,l),c.growthData=this.generateGrowthData(e,o,r,l,i,a,n),this.currentResults=c,this.displayResults(c),this.updateChart(c.growthData,a),this.announceResults(c)}calculateSimpleInterest(t,e,n){const a=t*(e/100)*n;return{principal:t,interest:a,total:t+a,effectiveAPY:e,rate:e,years:n}}calculateCompoundInterest(t,e,n,a){const o=t*Math.pow(1+e/100/a,a*n);return{principal:t,interest:o-t,total:o,effectiveAPY:100*(Math.pow(1+e/100/a,a)-1),rate:e,years:n}}generateGrowthData(t,e,n,a,o,s,i){const r=[],l=[];if("months"===s){const n=Math.max(1,Math.floor(i/12));for(let s=0;s<=i;s+=n){const n=s/12;let i;i="simple"===o?t*(1+e/100*n):t*Math.pow(1+e/100/a,a*n),r.push(i),l.push(`${s}m`)}}else for(let s=0;s<=n;s++){let n;n="simple"===o?t*(1+e/100*s):t*Math.pow(1+e/100/a,a*s),r.push(n),l.push(`${s}y`)}return{data:r,labels:l}}displayResults(t){this.animateValue("maturityAmount",0,t.total,1e3,"$"),this.animateValue("interestEarned",0,t.interest,1e3,"$"),this.animateValue("effectiveAPY",0,t.effectiveAPY,1e3,"%")}animateValue(t,e,n,a,o=""){const s=document.getElementById(t),i=performance.now(),r=t=>{const l=t-i,c=Math.min(l/a,1),d=1-Math.pow(1-c,3),u=e+(n-e)*d;s.textContent="$"===o?`$${u.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"%"===o?`${u.toFixed(2)}%`:u.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),c<1&&requestAnimationFrame(r)};requestAnimationFrame(r)}async updateChart(t,e){if(!window.Chart){console.error("Local Chart.js library not loaded - charts will not display");const t=document.getElementById("growthChart").parentElement;t.innerHTML='<div class="flex items-center justify-center h-48 text-gray-500"><p>Chart unavailable - Local Chart.js library not loaded</p></div>';return}const n=document.getElementById("growthChart").getContext("2d");this.chart&&this.chart.destroy();const a=document.documentElement.classList.contains("dark"),o=a?"#e5e7eb":"#374151",s=a?"#374151":"#e5e7eb";this.chart=new Chart(n,{type:"line",data:{labels:t.labels,datasets:[{label:"CD Balance",data:t.data,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:"#3b82f6",pointBorderColor:"#ffffff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!1},tooltip:{backgroundColor:a?"#1f2937":"#ffffff",titleColor:o,bodyColor:o,borderColor:a?"#374151":"#e5e7eb",borderWidth:1,callbacks:{label:function(t){return`Balance: $${t.parsed.y.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}}}},scales:{x:{title:{display:!0,text:"months"===e?"Time (Months)":"Time (Years)",color:o},ticks:{color:o},grid:{color:s}},y:{title:{display:!0,text:"Balance ($)",color:o},ticks:{color:o,callback:function(t){return"$"+t.toLocaleString()}},grid:{color:s}}}}})}updateChartTheme(){if(!this.chart)return;const t=document.documentElement.classList.contains("dark"),e=t?"#e5e7eb":"#374151",n=t?"#374151":"#e5e7eb";this.chart.options.scales.x.ticks.color=e,this.chart.options.scales.x.grid.color=n,this.chart.options.scales.x.title.color=e,this.chart.options.scales.y.ticks.color=e,this.chart.options.scales.y.grid.color=n,this.chart.options.scales.y.title.color=e,this.chart.options.plugins.tooltip.backgroundColor=t?"#1f2937":"#ffffff",this.chart.options.plugins.tooltip.titleColor=e,this.chart.options.plugins.tooltip.bodyColor=e,this.chart.options.plugins.tooltip.borderColor=t?"#374151":"#e5e7eb",this.chart.update()}announceResults(t){const e=document.getElementById("results-announcer");e&&(e.textContent=`CD calculation complete. Total at maturity: $${t.total.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}. Interest earned: $${t.interest.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}.`)}resetResults(){document.getElementById("maturityAmount").textContent="$0.00",document.getElementById("interestEarned").textContent="$0.00",document.getElementById("effectiveAPY").textContent="0.00%",this.chart&&(this.chart.destroy(),this.chart=null)}async exportToPDF(){if(!this.currentResults)return void alert("Please calculate CD results first.");if(!window.jspdf||!window.html2canvas){console.error("Local PDF libraries not loaded - jsPDF:",!!window.jspdf,"html2canvas:",!!window.html2canvas);alert("PDF export is currently unavailable. Local libraries not loaded.");return}const t=document.getElementById("loadingOverlay");t.classList.remove("hidden");try{const{jsPDF:t}=window.jspdf,e=new t;e.setFontSize(20),e.setTextColor(59,130,246),e.text("CD Calculator Results",20,30),e.setFontSize(12),e.setTextColor(0,0,0);const n=document.getElementById("cdForm"),a=parseFloat(n.principal.value),o=parseInt(n.term.value),s=n.termUnit.value,i=parseFloat(n.rate.value),r=n.compound.value,l=n.querySelector('input[name="interestType"]:checked').value;let c=50;const d=8;if(e.text(`Initial Deposit: $${a.toLocaleString()}`,20,c),c+=d,e.text(`Term: ${o} ${s}`,20,c),c+=d,e.text(`Interest Rate: ${i}%`,20,c),c+=d,e.text(`Compounding: ${r}`,20,c),c+=d,e.text(`Interest Type: ${l}`,20,c),c+=2*d,e.setFontSize(14),e.setTextColor(34,197,94),e.text("Results:",20,c),c+=1.5*d,e.setFontSize(12),e.setTextColor(0,0,0),e.text(`Total at Maturity: $${this.currentResults.total.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,20,c),c+=d,e.text(`Interest Earned: $${this.currentResults.interest.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,20,c),c+=d,e.text(`Effective APY: ${this.currentResults.effectiveAPY.toFixed(2)}%`,20,c),c+=2*d,this.chart)try{const t=document.getElementById("growthChart").toDataURL("image/png");e.addImage(t,"PNG",20,c,170,80),c+=90}catch(t){console.warn("Could not add local chart to PDF:",t)}e.setFontSize(10),e.setTextColor(128,128,128),e.text("This calculation is for educational purposes only.",20,c),e.text("Consult with a financial advisor for investment decisions.",20,c+5),e.text(`Generated on ${(new Date).toLocaleDateString()} by CodeByTanjil CD Calculator`,20,280),e.save("cd-calculator-results.pdf")}catch(t){console.error("Error generating PDF from local libraries:",t),alert("Error generating PDF. Please try again.")}finally{t.classList.add("hidden")}}shareResults(){if(!this.currentResults)return void alert("Please calculate CD results first.");const t=document.getElementById("cdForm"),e=parseFloat(t.principal.value),n=parseInt(t.term.value),a=t.termUnit.value,o=parseFloat(t.rate.value),s=`CD Calculator Results:\nðŸ’° Initial Deposit: $${e.toLocaleString()}\nðŸ“… Term: ${n} ${a}\nðŸ“ˆ Rate: ${o}%\nðŸ’µ Total at Maturity: $${this.currentResults.total.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}\nðŸ’¸ Interest Earned: $${this.currentResults.interest.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}\n\nCalculate your own CD returns: ${window.location.href}`;navigator.share?navigator.share({title:"CD Calculator Results",text:s,url:window.location.href}).catch(console.error):navigator.clipboard.writeText(s).then(()=>{alert("Results copied to clipboard!")}).catch(()=>{alert(s)})}}document.addEventListener("DOMContentLoaded",()=>{new CDCalculator});const style=document.createElement("style");style.textContent="\n    @keyframes fadeIn {\n        from { opacity: 0; transform: translateY(20px); }\n        to { opacity: 1; transform: translateY(0); }\n    }\n    \n    @keyframes fadeInUp {\n        from { opacity: 0; transform: translateY(30px); }\n        to { opacity: 1; transform: translateY(0); }\n    }\n    \n    @keyframes slideUp {\n        from { opacity: 0; transform: translateY(40px); }\n        to { opacity: 1; transform: translateY(0); }\n    }\n    \n    @keyframes pulseGlow {\n        0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }\n        50% { box-shadow: 0 0 30px rgba(168, 85, 247, 0.6); }\n    }\n    \n    @keyframes bounceIn {\n        0% { opacity: 0; transform: scale(0.3); }\n        50% { opacity: 1; transform: scale(1.05); }\n        70% { transform: scale(0.9); }\n        100% { opacity: 1; transform: scale(1); }\n    }\n    \n    @keyframes scaleIn {\n        from { opacity: 0; transform: scale(0.8); }\n        to { opacity: 1; transform: scale(1); }\n    }\n    \n    .animate-fade-in { animation: fadeIn 0.6s ease-out; }\n    .animate-fade-in-up { animation: fadeInUp 0.8s ease-out; }\n    .animate-slide-up { animation: slideUp 0.6s ease-out; }\n    .animate-pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }\n    .animate-bounce-in { animation: bounceIn 0.8s ease-out; }\n    .animate-scale-in { animation: scaleIn 0.5s ease-out; }\n    \n    .sr-only {\n        position: absolute;\n        width: 1px;\n        height: 1px;\n        padding: 0;\n        margin: -1px;\n        overflow: hidden;\n        clip: rect(0, 0, 0, 0);\n        white-space: nowrap;\n        border: 0;\n    }\n",document.head.appendChild(style);
